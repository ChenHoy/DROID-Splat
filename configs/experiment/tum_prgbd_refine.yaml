# @package _global_
# Make sure we use the tum configuration
defaults:
  - override /data: TUM_RGBD/fr1
  - override /tracking: tum
  - override /mapping: tum

mode: prgbd

mapping:
  filter: # Parameter for filtering incoming points from the SLAM system
    multiview: True # Only initialize Gaussians that are consistent in multiple views
    mv_count_th: 2 # Pixels need to be consistent within bin_thresh distance across these k views
    bin_th: 0.01 # Distance between points for binning, this depends on the scene scale, so be careful!

  input:
    pcd_downsample_init: 32 # This is a constant downsampling factor
    pcd_downsample: 32 # You ideally have ~5-10k points per frame

  refinement:
    optimize_poses: True
    use_non_keyframes: True # Use RGB non-keyframes as well during map refinement

    iters: 20 # Optimize over this many different batches
    batch_iters: 50 # Optimize each batch this many times
    lr_factor: 0.5 # Change the learning rate for refinement
    bs: 40 # Batch size for refinement 

    sampling:
      use_neighborhood: True
      neighborhood_size: 8 # If this is an even number, we sample more frames in the past
      weighted: False
      kf_at_least: 0.5 # Always make sure to have > x% keyframes in a batch

    prune_densify_every: 3 # This uses i) vanilla split and clone from 3DGS and ii) opacity based densificatio# This has to be an uneven number
    densify_until: 8 # Dont densify/prune after this many iterations, ALL gaussians are well optimized